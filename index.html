<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>demo - leaflet-gps-tracker</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="./GPSControl.js"></script>
  
     <!-- Load Esri Leaflet from CDN -->
  <script src="https://unpkg.com/esri-leaflet@2.3.3/dist/esri-leaflet.js"
  integrity="sha512-cMQ5e58BDuu1pr9BQ/eGRn6HaR6Olh0ofcHFWe5XesdCITVuSBiBZZbhCijBe5ya238f/zMMRYIMIIg1jxv4sQ=="
  crossorigin=""></script>


  <!-- Load Esri Leaflet Geocoder from CDN -->
  <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.css"
    integrity="sha512-IM3Hs+feyi40yZhDH6kV8vQMg4Fh20s9OzInIIAc4nx7aMYMfo+IenRUekoYsHZqGkREUgx0VvlEsgm7nCDW9g=="
    crossorigin="">
  <script src="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.js"
    integrity="sha512-8twnXcrOGP3WfMvjB0jS5pNigFuIWj4ALwWEgxhZ+mxvjF5/FBPVd5uAxqT8dd2kUmTVK9+yQJ4CmTmSg/sXAQ=="
    crossorigin=""></script>


   
    <style>
      html, body {
        width: 100%;
        height: 100%;
      }
      .leaflet-container {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <h1>demo - leaflet-gps-tracker</h1>

    <h2>Full location and tracking functionality</h2>

    <div id="map"></div>
    <div id="msg"></div>

 

    <script>



    var geocodeService = L.esri.Geocoding.geocodeService();



      var msg = document.getElementById('msg');
      var map = L.map('map');
      let marker = null
      map.setZoom(16);
      new L.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        minZoom: 5,
        maxZoom: 20,
       
      }).addTo(map);

      new GPSControl({
        track: true,
        accuracy: true,
        autoCenter: false,
        activeCallback: active => {
          msg.innerHTML += 'GPS tracking is active ? ' + active + '<br/>';
        },
        successCallback: latlngG => {
          msg.innerHTML += 'GPS tracking detected a position change : ' + latlngG + '<br/>';
          map.setView(latlngG);

          if(marker !== null){
            map.removeLayer(marker);
          }
          
        
        //  marker =  L.marker(latlngG).addTo(map)
        //   .bindPopup('You are here ' + latlngG + '<br/>')
        //   .openPopup();

          
          geocodeService.reverse().latlng(latlngG).run(function (error, result) {
            if (error) {
              return;
            }

           marker  = L.marker(result.latlng).addTo(map).bindPopup(result.address.Match_addr).openPopup();
  
          });
          
        },
        errorCallback: error => {
          msg.innerHTML += 'GPS tracking failed : ' + error.message + '<br/>';
        }

        
      }).addTo(map);




    </script>

  

  </body>
</html>